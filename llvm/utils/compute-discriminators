#!/bin/bash -e

syms="
memcmp
non_const_memrchr
strnlen
_longjmp
_setjmp
longjmp
setjmp
siglongjmp
sigsetjmp
syscall
vfork
__memcpy_chk
wmemmove
memcpy
memmove
memset
__memset_chk
acct
adjtimex
bind
capget
capset
chdir
chroot
clock_adjtime
clock_settime
delete_module
epoll_ctl
execve
_exit
fallocate
fchdir
fchown
fchownat
fdatasync
flock
fremovexattr
fstat64
fstatat64
fsync
ftruncate
getegid
geteuid
getgid
getgroups
getitimer
getpeername
getpgid
getppid
getrandom
getresgid
getresuid
getrlimit
getrusage
getsid
getsockname
getsockopt
getuid
getxattr
init_module
inotify_add_watch
inotify_init1
inotify_rm_watch
kill
klogctl
lgetxattr
linkat
listen
listxattr
llistxattr
lremovexattr
lseek
lsetxattr
madvise
memfd_create
mincore
mkdirat
mknodat
mlock
mlock2
mlockall
mmap
mount
mprotect
msync
munlock
munlockall
munmap
nanosleep
personality
prctl
pread64
preadv
prlimit64
process_vm_readv
process_vm_writev
pwrite64
pwritev
quotactl
read
readahead
readlinkat
readv
recvfrom
removexattr
renameat
renameat2
sched_getparam
sched_get_priority_max
sched_get_priority_min
sched_getscheduler
sched_rr_get_interval
sched_setaffinity
sched_setparam
sched_setscheduler
sched_yield
sendfile
setdomainname
setfsgid
setfsuid
setgid
setgroups
sethostname
setitimer
setns
setpgid
setpriority
setregid
setresgid
setresuid
setreuid
setrlimit
setsid
setsockopt
settimeofday
setuid
setxattr
shutdown
sigaltstack
splice
statx
swapoff
swapon
symlinkat
sync
syncfs
sysinfo
tee
tgkill
timerfd_create
timerfd_gettime
timerfd_settime
times
truncate
umask
umount2
uname
unlinkat
unshare
utimensat
vmsplice
wait4
write
writev
android_memset16
android_memset32
llrint
llrintf
lrint
lrintf
sqrt
sqrtf
unw_getcontext
"

. $(dirname $0)/../../frankendroid.rc

(
echo '#ifdef ANDROID_EXPERIMENTAL_PAC'
for i in $syms; do
  $(dirname $0)/compute-discriminator $i | sed -e 's/\<memcmp\>/__memcmp_aarch64/; s/\<non_const_memrchr\>/__memrchr_aarch64/; s/\<strnlen\>/__strnlen_aarch64/'
done
echo '#endif'
) > $androiddir/bionic/libc/include/symauth.h
