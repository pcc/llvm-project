From 1f5e3d69b01db464c25d3238c73fe04a79be2ab6 Mon Sep 17 00:00:00 2001
From: Peter Collingbourne <pcc@google.com>
Date: Thu, 16 Jul 2020 17:56:41 -0700
Subject: [PATCH 07/36] Support TARGET_EXPERIMENTAL_PAC=size for size
 measurements

---
 build/soong/cc/config/arm64_device.go | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/build/soong/cc/config/arm64_device.go b/build/soong/cc/config/arm64_device.go
index 7c38d16489..0d82f0bc3a 100644
--- a/build/soong/cc/config/arm64_device.go
+++ b/build/soong/cc/config/arm64_device.go
@@ -217,6 +217,8 @@ func arm64ToolchainFactory(arch android.Arch) Toolchain {
 		toolchainClangCflags = append(toolchainClangCflags, "-DANDROID_EXPERIMENTAL_PAC", "-fptrauth-returns", "-fptrauth-intrinsics", "-fptrauth-calls", "-fptrauth-indirect-gotos", "-fptrauth-auth-traps")
 		if android.TargetExperimentalPac == "fake" {
 			toolchainClangCflags = append(toolchainClangCflags, "-mllvm", "-fake-pac", "-DANDROID_FAKE_PAC")
+		} else if android.TargetExperimentalPac == "size" {
+			toolchainClangCflags = append(toolchainClangCflags, "-march=armv8.3a", "-mllvm", "-pac-size-measurements-only")
 		} else {
 			toolchainClangCflags = append(toolchainClangCflags, "-march=armv8.3a")
 		}
-- 
2.29.2.729.g45daf8777d-goog

