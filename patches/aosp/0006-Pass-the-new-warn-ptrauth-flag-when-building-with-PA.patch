From 354d91fe3419075cc2344317ef7792f875e01d1a Mon Sep 17 00:00:00 2001
From: Peter Collingbourne <pcc@google.com>
Date: Thu, 16 Jul 2020 17:56:15 -0700
Subject: [PATCH 06/36] Pass the new --warn-ptrauth flag when building with PAC

We don't want to see warnings when PAC is disabled.
---
 build/soong/cc/config/arm64_device.go | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/build/soong/cc/config/arm64_device.go b/build/soong/cc/config/arm64_device.go
index 982dbb226e..7c38d16489 100644
--- a/build/soong/cc/config/arm64_device.go
+++ b/build/soong/cc/config/arm64_device.go
@@ -228,6 +228,10 @@ func arm64ToolchainFactory(arch android.Arch) Toolchain {
 		extraLdflags = "-Wl,--fix-cortex-a53-843419"
 	}
 
+	if android.TargetExperimentalPac != "" {
+		extraLdflags += " -Wl,--warn-ptrauth"
+	}
+
 	return &toolchainArm64{
 		ldflags: strings.Join([]string{
 			"${config.Arm64Ldflags}",
-- 
2.29.2.729.g45daf8777d-goog

