From 214d6d40eb48e7ee40703a7ed62d7d49a18a385f Mon Sep 17 00:00:00 2001
From: Peter Collingbourne <pcc@google.com>
Date: Tue, 22 Sep 2020 16:48:36 -0700
Subject: [PATCH 15/16] Disable building some ELF TLS tests for now

They trigger an assertion failure in the compiler.
---
 bionic/tests/elftls_test.cpp                | 4 ++++
 bionic/tests/libs/elftls_dynamic.cpp        | 4 ++++
 bionic/tests/libs/elftls_dynamic_filler.cpp | 4 ++++
 3 files changed, 12 insertions(+)

diff --git a/bionic/tests/elftls_test.cpp b/bionic/tests/elftls_test.cpp
index 7c072b62f7..e2d0ad12ef 100644
--- a/bionic/tests/elftls_test.cpp
+++ b/bionic/tests/elftls_test.cpp
@@ -1,3 +1,5 @@
+#ifndef ANDROID_EXPERIMENTAL_PAC
+
 /*
  * Copyright (C) 2019 The Android Open Source Project
  * All rights reserved.
@@ -87,3 +89,5 @@ TEST(elftls, general) {
     ASSERT_EQ(31, ++tlsvar_general);
   }).join();
 }
+
+#endif
diff --git a/bionic/tests/libs/elftls_dynamic.cpp b/bionic/tests/libs/elftls_dynamic.cpp
index 25004848c6..7bc61d987f 100644
--- a/bionic/tests/libs/elftls_dynamic.cpp
+++ b/bionic/tests/libs/elftls_dynamic.cpp
@@ -1,3 +1,5 @@
+#ifndef ANDROID_EXPERIMENTAL_PAC
+
 /*
  * Copyright (C) 2019 The Android Open Source Project
  * All rights reserved.
@@ -71,3 +73,5 @@ __attribute__((weak)) extern "C" __thread int missing_weak_dyn_tls;
 extern "C" int* missing_weak_dyn_tls_addr() {
   return &missing_weak_dyn_tls;
 }
+
+#endif
diff --git a/bionic/tests/libs/elftls_dynamic_filler.cpp b/bionic/tests/libs/elftls_dynamic_filler.cpp
index 9c00ab0694..6116f8f53f 100644
--- a/bionic/tests/libs/elftls_dynamic_filler.cpp
+++ b/bionic/tests/libs/elftls_dynamic_filler.cpp
@@ -1,3 +1,5 @@
+#ifndef ANDROID_EXPERIMENTAL_PAC
+
 /*
  * Copyright (C) 2019 The Android Open Source Project
  * All rights reserved.
@@ -31,3 +33,5 @@ __thread int var = TLS_FILLER;
 extern "C" int bump() {
   return ++var;
 }
+
+#endif
-- 
2.28.0.681.g6f77f65b4e-goog

